<html>
<head>
<!--script type="text/javascript" lang="javascript" src="//cdns.global.gigya.com/JS/gigya.js?apikey=4_P1PsLai8qySAAQGymJ4UuA"></script-->
<script type="text/javascript" lang="javascript" src="script.js"></script>
<script>

    var params = getParametersFromUrl();
    
    function GigyaLoadFunctions() {

 
        try {
            gigya.accounts.session.verify({
                callback: function(e) {
                    console.log("session.verify ", e);
                    if(e.errorCode == 0) {
                        // a session is open
                        window.location.href="/account.html";
                    } else {
                        // non session
                        gigya.accounts.showScreenSet({
                            containerID:'containerlogin', 
                            screenSet:'Euronews-RegistrationLogin', 
                            startScreen:'gigya-login-screen',
                            enabledProviders: 'googleplus,facebook,apple',
                            context: {
                                nl: params['nl']
                            }});
                    }
                }
            });
        }catch(e) {
            console.e(e);
        }
        gigya.accounts.addEventHandlers({
            onConnectionAdded: function (e) {
                alert("user onConnectionAdded");
                console.log("onConnectionAdded", e);
            },
        });


        gigya.socialize.addEventHandlers({
            onLogin: function (e) {
                console.log("e onlogin", e);
                if(e.newUser == true && e.providers != '' ) {
                    // must save NL pre-selected NL
                    try {
                    console.log(" --> is new user from social provider and must save subscription", e);
                    var nlselected = e.context.nl;
                    console.log("nlselected ", nlselected);
                    
                    let nls = nlselected.split(',');
                    let subscriptionObject = {};
                    for (i = 0; i < nls.length; i++) {
                        let nlitem = nls[i];
                        console.log("nlitem:", nlitem);
                        subscriptionObject[nlitem] = {
                            email : {
                                isSubscribed: true
                            }
                        }
                    }
                    console.log("subscriptionObject :", subscriptionObject);
                    gigya.accounts.setAccountInfo({
                        'subscriptions' : subscriptionObject,
                        'callback': function(e) {
                            console.log(e);
                        }
                    });
                    /*
                    gigya.accounts.setAccountInfo({
                        'subscriptions' : {
                            'green': {
                                'email' : {
                                    'isSubscribed':true
                                }
                            }
                        }
                    });
                    */
                    // subscriptions.green.email.isSubscribed=true;
                    } catch(e) {
                        console.error(e);
                    }
                }
                alert("user logged successfull");            
                window.location.href="/account.html";
            },
            onLogout: function () {
                alert("user logout successfull");            
                window.location.href="/index.html";
            }
        });
    }

    function onGigyaServiceReady() {
        GigyaLoadFunctions();
    }
                
    loadGigya( params['lang'] || navigator.language || navigator.userLanguage);
    </script>    
    <link rel="stylesheet" href="/style.css">  
</head>
<body>
<div class="header">
    <img src="/img/logo.png">
</div>
<div class="langs">
    <ul>
        <li><a href="?lang=en">English(en)</a></li>
        <li><a href="?lang=fr">French(fr)</a></li>
        <li><a href="?lang=de">German(de)</a></li>
        <li><a href="?lang=it">Italian(it)</a></li>
        <li><a href="?lang=es">Spanish(es)</a></li>
        <li><a href="?lang=pt">Portuguese(pt)</a></li>
        <li><a href="?lang=ru">Russian(ru)</a></li>
        <li><a href="?lang=ar">Arabic(ar)</a></li>
        <li><a href="?lang=fa">Parsi(fa)</a></li>
        <li><a href="?lang=tr">Turkish(tr)</a></li>
        <li><a href="?lang=el">Greek(el)</a></li>
        <li><a href="?lang=hu">Hungarian(hu)</a></li>
    </ul>
</div>
<div class="block-content">
    <div id="containerlogin"></div>
</div>
</body>
</html>
